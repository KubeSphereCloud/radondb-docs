




<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[Kubernetes, {ks_product}, RadonDB, RadonDB OpenSearch,证书]">



<meta name="description" content="介绍如何配置 OpenSearch 集群服务端证书。">

<link rel="icon" href="/images/favicon.ico" type="image/x-icon">

<title>配置 OpenSearch 集群服务端证书 - RadonDB DMP 数据库管理平台</title>
<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/css/atom-one-light.css" rel="stylesheet" />
<link href="/css/magnific-popup.css" rel="stylesheet" />


<link href="/scss/main.min.3f975d466d577a77f0f174d270294cab5515450a1619ced59c3e7370b108aeb6.css" rel="stylesheet" integrity="sha256-P5ddRm1Xenfw8XTScClMq1UVRQoWGc7VnD5zcLEIrrY=">

<script src="/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="/images/qingcloud-logo.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">RadonDB DMP 数据库管理平台</div>
      </a>
    
    <div class="navbar-nav">
      <div
        class="navbar-nav-item navbar-nav-version "
        style="">
        
        <div class="dropdown-trigger">
          <span class="project-version">
            v2.0
          </span>
          
        </div>
        
      </div>
      
    </div>
    <div class="search navbar-search">
      <form action="/v2.0/search/" method="GET">
        <div class="control has-icons-left has-icons-right docs-search-input">
          <span class="icon is-left">
            <img src="/images/icons/magnifier_duotone.svg" />
          </span>
          <input
            class="input"
            name="q"
            type="input"
            placeholder="请输入关键字快速获取帮助"
            autocomplete="off"
          />
          <span class="icon is-right"> </span>
        </div>
        <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
      </form>
      <div class="search-result navbar-search-result">
        <div class="search-result-loading"></div>
        <div class="search-result-content"></div>
        <div class="search-result-none">
          没有找到搜索结果， 请更换关键词重新搜索
        </div>
      </div>
    </div>
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/v2.0/">
          
            DMP 数据库管理平台
        </a>
        
      </div>
      
    
    <nav class="sidebar-menu">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/01-intro/">产品简介</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/01-intro/01-overview/">产品概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/01-intro/02-access-dmp/">进入数据库管理平台</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/02-radondb-mysql/">MySQL</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/01-install-radondb-mysql/">创建 MySQL 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/02-radondb-mysql/03-manage-database-users/">管理数据库用户</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/03-manage-database-users/01-create-a-database-user/">创建数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/03-manage-database-users/02-edit-a-database-user/">编辑数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/03-manage-database-users/03-delete-database-users/">删除数据库用户</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/04-access-the-database/">访问 MySQL 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/">管理数据库备份</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/01-enable-database-auto-backup/">开启 MySQL 数据库自动备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/02-create-database-backup/">创建 MySQL 数据库备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/03-view-database-backup/">查看 MySQL 数据库备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/04-restore-database/">从备份恢复 MySQL 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/06-manage-database-backup/05-delete-database-backup/">删除 MySQL 数据库备份</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/07-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/08-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/09-adjust-cpu-and-memory-resources-copy/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/10-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/02-radondb-mysql/11-delete-radondb-mysql/">删除 MySQL 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a href="/v2.0/04-radondb-opensearch/">OpenSearch</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/01-install-radondb-opensearch/">创建 OpenSearch 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/03-access-the-database/">访问 OpenSearch 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/05-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/06-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/07-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/08-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/09-delete-radondb-opensearch/">删除 OpenSearch 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a href="/v2.0/04-radondb-opensearch/11-configure-certificates/">配置 OpenSearch 集群证书</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/11-configure-certificates/01-configure-client-certificate/">配置 OpenSearch 集群客户端证书</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item active current">
            <a href="/v2.0/04-radondb-opensearch/11-configure-certificates/02-configure-server-certificate/">配置 OpenSearch 集群服务端证书</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/04-radondb-opensearch/12-connect-logstash-to-kafka/">对接 Logstash 和 Kafka</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/05-radondb-redis-cluster/">Redis Cluster</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/01-install-radondb-redis-cluster/">创建 Redis Cluster 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/05-radondb-redis-cluster/03-manage-database-users/">管理数据库用户</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/03-manage-database-users/01-create-a-database-user/">创建数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/03-manage-database-users/02-edit-a-database-user/">编辑数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/03-manage-database-users/03-delete-database-users/">删除数据库用户</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/04-access-the-database/">访问 Redis Cluster 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/07-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/08-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/09-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/10-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/05-radondb-redis-cluster/11-delete-radondb-redis-cluster/">删除 Redis Cluster 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/06-radondb-redis-sentinel/">Redis Sentinel</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/01-install-radondb-redis-sentinel/">创建 Redis Sentinel 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/06-radondb-redis-sentinel/03-manage-database-users/">管理数据库用户</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/03-manage-database-users/01-create-a-database-user/">创建数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/03-manage-database-users/02-edit-a-database-user/">编辑数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/03-manage-database-users/03-delete-database-users/">删除数据库用户</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/04-access-the-database/">访问 Redis Sentinel 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/07-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/08-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/09-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/10-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/06-radondb-redis-sentinel/11-delete-radondb-redis-sentinel/">删除 Redis Sentinel 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/07-radondb-mongodb/">MongoDB</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/01-install-radondb-mongodb/">创建 MongoDB 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/03-access-the-database/">访问 MongoDB 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/05-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/06-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/07-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/08-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/07-radondb-mongodb/09-delete-radondb-mongodb/">删除 MongoDB 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/08-radondb-postgresql/">PostgreSQL</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/01-install-radondb-postgresql/">创建 PostgreSQL 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/02-view-database-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/08-radondb-postgresql/03-manage-database-users/">管理数据库用户</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/03-manage-database-users/01-create-a-database-user/">创建数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/03-manage-database-users/02-edit-a-database-user/">编辑数据库用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/03-manage-database-users/03-delete-database-users/">删除数据库用户</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/04-access-the-database/">访问 PostgreSQL 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/">管理数据库备份</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/01-enable-database-auto-backup/">开启 PostgreSQL 数据库自动备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/02-create-database-backup/">创建 PostgreSQL 数据库备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/03-view-database-backup/">查看 PostgreSQL 数据库备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/04-restore-database/">从备份恢复 PostgreSQL 数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/06-manage-database-backup/05-delete-database-backup/">删除 PostgreSQL 数据库备份</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/07-manage-parameters/">修改数据库配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/08-scale-out-the-database-cluster/">扩展数据库节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/09-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/10-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/11-delete-radondb-postgresql/">删除 PostgreSQL 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/08-radondb-postgresql/12-migrate-data/">迁移 PostgreSQL 数据</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/10-radondb-kafka/">Kafka</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/01-quickstart/">快速入门</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/02-install-radondb-kafka/">创建 Kafka 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/03-view-kafka-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/10-radondb-kafka/04-manage-database-users/">管理 Kafka 用户</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/04-manage-database-users/01-create-a-database-user/">创建 Kafka 用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/04-manage-database-users/02-edit-a-database-user/">编辑 Kafka 用户</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/04-manage-database-users/03-delete-database-users/">删除 Kafka 用户</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/05-access-kafka/">访问 Kafka </a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/10-radondb-kafka/07-manage-topics/">管理主题</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/07-manage-topics/01-create-topics/">创建主题</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/07-manage-topics/02-edit-topics/">编辑主题</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/07-manage-topics/03-delete-topics/">删除主题</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/08-manage-parameters/">修改配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/09-scale-out-the-database-cluster/">扩展 Kafka 节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/10-rebalance-nodes/">重平衡 Kafka 节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/11-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/12-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/10-radondb-kafka/13-delete-radondb-kafka/">删除 Kafka 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/11-radondb-rabbitmq/">RabbitMQ</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/01-install-radondb-rabbitmq/">创建 RabbitMQ 实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/02-view-rabbitmq-running-status/">查看运行状态</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/04-access-rabbitmq/">访问 RabbitMQ</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/07-manage-parameters/">修改配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/08-scale-out-the-database-cluster/">扩展 RabbitMQ 节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/09-adjust-cpu-and-memory-resources/">调整 CPU 和内存资源</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/10-expand-the-volume/">扩展卷</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/11-radondb-rabbitmq/11-delete-radondb-rabbitmq/">删除 RabbitMQ 实例</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/12-backup-management/">备份管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/12-backup-management/01-create-a-backup-repository/">创建备份仓库</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v2.0/12-backup-management/02-backup-data-management/">管理数据库备份</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/12-backup-management/02-backup-data-management/01-view-backup-list/">查看数据库备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/12-backup-management/02-backup-data-management/02-restore-from-a-backup/">从备份恢复数据库实例</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v2.0/12-backup-management/02-backup-data-management/03-delete-a-backup/">删除数据库备份</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/v2.0" data-url="/v2.0">RadonDB DMP 数据库管理平台</a></li>
      <li class="icon-slash_fill"><a href="/v2.0/04-radondb-opensearch" data-url="/v2.0/04-radondb-opensearch">OpenSearch</a></li>
      <li class="icon-slash_fill"><a href="/v2.0/04-radondb-opensearch/11-configure-certificates" data-url="/v2.0/04-radondb-opensearch/11-configure-certificates">配置 OpenSearch 集群证书</a></li>
      <li class="icon-slash_fill"><a href="/v2.0/04-radondb-opensearch/11-configure-certificates/02-configure-server-certificate" data-url="/v2.0/04-radondb-opensearch/11-configure-certificates/02-configure-server-certificate">配置 OpenSearch 集群服务端证书</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    配置 OpenSearch 集群服务端证书</h1>
  <div class="post-info">
    <div class="post-date">
      更新时间：2023-11-22 02:07:08
    </div>
    
    
    
    
    
    
    
      <div
        class="tag post-tag export-pdf has-tooltip-top has-tooltip-arrow"
        data-tooltip="下载范围：所属一级目录的全部内容"
        data-url="/v2.0/04-radondb-opensearch">
        <span class="icon-format_pdf_2_fill"></span>
        PDF
      </div>
      
    
  </div><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_opensearch_集群内部自动生成证书">OpenSearch 集群内部自动生成证书</a></li>
    <li><a href="#_用户自定义证书">用户自定义证书</a></li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="paragraph">
<p>本节介绍如何配置 OpenSearch 集群服务端证书。</p>
</div>
<div class="paragraph">
<p>服务端证书有以下两种生成方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenSearch 集群内部自动生成证书(默认)，具有以下特点：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>有效期为 10 年。</p>
</li>
<li>
<p>暂不支持证书更换或续签。</p>
</li>
<li>
<p>该证书仅能在 Kubernetes 集群内部使用，无法用于 Kubernetes 外部访问。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>用户自定义证书，具有以下特点：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>自定义有效期。</p>
</li>
<li>
<p>暂不支持证书更换或续签。</p>
</li>
<li>
<p>该证书可用于从 Kubernetes 集群外部访问 OpenSearch 集群。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_opensearch_集群内部自动生成证书">OpenSearch 集群内部自动生成证书</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在 OpenSearch Dashboards 上开启 TLS 认证。</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>将 <strong>spec.dashboards.tls.enable</strong> 的值设置为 <strong>true</strong>。</p>
</li>
<li>
<p>将 <strong>spec.dashboards.tls.generate</strong> 的值设置为 <strong>true</strong>。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>在 OpenSearch 集群上开启 TLS 认证。</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>将 <strong>spec.security.tls.transport.generate</strong> 的值设置为 <strong>true</strong>。</p>
</li>
<li>
<p>将 <strong>spec.security.tls.http.generate</strong> 的值设置为 <strong>true</strong>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>配置文件如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: opensearch.opster.io/v1
kind: OpenSearchCluster
metadata:
  name: os-001
spec:
  general:
    version: 2.3.0
    httpPort: 9200
    vendor: opensearch
    serviceName: os-001

  dashboards:
    version: 2.3.0
    enable: true
    replicas: 1
    resources:
      requests:
         memory: &#34;1Gi&#34;
         cpu: &#34;500m&#34;
      limits:
         memory: &#34;1Gi&#34;
         cpu: &#34;500m&#34;
    tls:
      enable: true
      generate: true

  confMgmt:
    smartScaler: true
  security:
    config:
      securityConfigSecret:
# Pre create this secret with required security configs, to override the default settings
        name: securityconfig-secret
      adminCredentialsSecret:
        name: admin-credentials-secret
    tls:
      transport:
        generate: true

      http:
        generate: true

  nodePools:
    - component: masters
      replicas: 3
      diskSize: &#34;50Gi&#34;
      persistence:
        pvc:
          storageClass: csi-qingcloud
          accessModes:
            - ReadWriteOnce
      nodeSelector:
      resources:
         requests:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
         limits:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
      roles:
        - &#34;cluster_manager&#34;

    - component: data-hot
      replicas: 2
      diskSize: &#34;80Gi&#34;
      persistence:
        pvc:
          storageClass: csi-qingcloud
          accessModes:
            - ReadWriteOnce
      additionalConfig:
        node.attr.datatier: &#34;hot&#34; # warm, cold
      resources:
         requests:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
         limits:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
      roles:
        - &#34;data&#34;

---
apiVersion: v1
kind: Secret
metadata:
  name: admin-credentials-secret
type: Opaque
data:
  username: c2h1YWliMTIz
  password: c2h1YWliMTIz</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在 master 节点上执行以下命令创建集群。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch# kubectl -n opensearch apply -f ./os-ssl-true.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在 master 节点执行以下命令，并访问 <a href="https://cluster-name.namespace:9200" class="bare">https://cluster-name.namespace:9200</a> 验证 OpenSearch 证书是否可用。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch# kubectl -n opensearch exec -it pod/os-001-masters-0 -c opensearch -- /bin/bash [opensearch@os-001-masters-0 ~]$ curl https://os-001.opensearch.svc:9200/_cat/nodes -u root:U61yyB86o2QbyyFo --cacert /usr/share /opensearch/config/tls-http/ca.crt
10.10.194.117 40 93 7 1.03 1.04 1.02 d data - os-001-data-hot-1
10.10.215.129 46 88 9 0.52 0.65 0.84 m cluster_manager - os-001-masters-1 10.10.215.128 51 94 5 0.52 0.65 0.84 d data - os-001-data-hot-0 10.10.2.137 45 100 8 1.98 1.21 1.12 m cluster_manager * os-001-masters-0 10.10.194.118 44 88 17 1.03 1.04 1.02 m cluster_manager - os-001-masters-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>此处 <strong>--cacert</strong> 指定了 CA 证书的路径 <strong>/usr/share/opensearch/config/tls-http/ca.crt</strong>。</p>
</div>
</div>
</div>
</li>
<li>
<p>在 Dashboard 节点执行以下命令，并访问 <a href="https://cluster-name-dashboards:5601" class="bare">https://cluster-name-dashboards:5601</a> 验证 Dashboard 证书是否可用。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch# kubectl -n opensearch exec -it os-001-dashboards-7d9886689d-zd7jb -- /bin/bash
[opensearch-dashboards@os-001-dashboards-7d9886689d-zd7jb ~]$ curl https://os-001-dashboards:5601 -u dashboarduser:dashboarduser
curl: (60) SSL certificate problem: unable to get local issuer certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
[opensearch-dashboards@os-001-dashboards-7d9886689d-zd7jb ~]$ curl https://os-001-dashboards:5601 -u dashboarduser:dashboarduser --cacert /usr/share/opensearch-dashboards/certs/tls.crt
[opensearch-dashboards@os-001-dashboards-7d9886689d-zd7jb ~]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>此处 <strong>--cacert</strong> 指定了 CA 证书的路径 <strong>/usr/share/opensearch/config/tls-http/ca.crt</strong>。</p>
</div>
<div class="paragraph">
<p>集群内部生成的证书名称为 &lt;cluster-name&gt;-ca  和 &lt;cluster-name&gt;-dashboards-cert，如下图所示。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/dmp/os-certificate.png" alt="os certificate"/>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行以下命令获取 OpenSearch 集群 CA 证书并保存到 <strong>ca-test.cert</strong> 文件中。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu# kubectl -n opensearch get secrets os-001-ca  -ojsonpath=&#39;{.data}&#39; | jq -r &#39;.&#34;ca.crt&#34;&#39; | base64 -d &gt; test-ca.crt</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/dmp/certificate-details.png" alt="certificate details"/>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_用户自定义证书">用户自定义证书</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用 OpenSSL 签发 Dashboard 和 OpenSearch 证书。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>规划证书。</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 80%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">项目</th>
<th class="tableblock halign-left valign-top">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>CN</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>*.&lt;cluster-name&gt;.&lt;namespace&gt;.svc.cluster.local</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SAN</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>*.&lt;cluster-name&gt;.&lt;namespace&gt;.svc.cluster.local</p>
</div>
<div class="paragraph">
<p><strong>.&lt;cluster-name&gt;-dashboards.</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>创建 CA 证书 <strong>root-ca.pem</strong> 和 <strong>root-ca-key.pem</strong>。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">openssl genrsa -out root-ca-key.pem 2048
openssl req -new -x509 -sha256 -key root-ca-key.pem -subj &#34;/C=CN/ST=STATE/L=CITY/O=ORG/OU=UNIT/CN=demo@nowhere.com&#34; -out root-ca.pem -days 3650</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>创建证书配置文件 <strong>san.cnf</strong>。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">[req]
distinguished_name = req_distinguished_name
req_extensions = req_ext
prompt = no
[req_distinguished_name]
CN = *.os002.opensearch.svc.cluster.local
[req_ext]
subjectAltName = @alt_names
[alt_names]
DNS.1 = *.os002.opensearch.svc.cluster.local
DNS.2 = *.os002-dashboards.*</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>此处集群名称 os002，namespace 名称 opensearch 仅为示例，请根据实际情况替换。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>创建证书 <strong>my.crt</strong> 和 <strong>my.key</strong>。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">openssl req -out my.csr -newkey rsa:2048 -nodes -keyout my.key -config san.cnf
openssl x509 -req -in my.csr -CA root-ca.pem -CAkey root-ca-key.pem -CAcreateserial -sha256 -out my.crt -days 36 50 -extensions req_ext -extfile san.cnf</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>验证证书，含 CN 和 SAN 项。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"> openssl x509 -in my.crt -noout -text</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/dmp/verify-certificate.png" alt="verify certificate"/>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>通过 <strong>my.crt</strong> 和 <strong>my.key</strong> 创建 HTTP 证书。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch/certs# kubectl -n opensearch create secret tls cluster-http-cert --cert=my.crt --key=my.key
secret/cluster-http-cert created</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>通过 <strong>root-ca.pem</strong> 创建 CA 证书。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch/certs# kubectl -n opensearch create secret generic cluster-ca --from-file=ca.crt=./root-ca.pem -- from-file=ca.key=./root-ca-key.pem
secret/cluster-ca created</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>参照以下内容配置 CR 文件。</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>开启 Dashboard TLS 认证</p>
<div class="ulist">
<ul>
<li>
<p>将 <strong>spec.dashboards.tls.enable</strong> 设置为 <strong>true</strong>。</p>
</li>
<li>
<p><strong>spec.dashboards.tls.generate</strong>设置为 <strong>false</strong>。</p>
</li>
<li>
<p><strong>spec.dashboards.tls.secret</strong> 设置为 HTTP 证书名称， 此处为 <strong>cluster-http-cert</strong>。</p>
</li>
<li>
<p><strong>spec.dashboards.tls.caSecret</strong> 设置为 CA  证书名称， 此处为 <strong>cluster-ca</strong>。</p>
</li>
</ul>
</div>
</li>
<li>
<p>开启 OpenSearch 集群 TLS 认证</p>
<div class="ulist">
<ul>
<li>
<p><strong>spec.security.tls.transport.generate</strong> 设置为 <strong>true</strong>。</p>
</li>
<li>
<p><strong>spec.security.tls.transport.caSecret</strong> 设置为 CA 证书名称， 此处为 <strong>cluster-ca</strong>。</p>
</li>
<li>
<p><strong>spec.security.tls.http.generate</strong> 设置为 <strong>false</strong>。</p>
</li>
<li>
<p><strong>spec.security.tls.http.caSecret</strong> 设置为 CA 证书名称， 此处为 <strong>cluster-ca</strong>。</p>
</li>
<li>
<p><strong>spec.security.tls.http.secret</strong> 设置为 HTTP 证书名称， 此处为 <strong>cluster-http-cert</strong>。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>配置文件如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: opensearch.opster.io/v1
kind: OpenSearchCluster
metadata:
  name: os002
spec:
  general:
    version: 2.3.0
    httpPort: 9200
    vendor: opensearch
    serviceName: os002

  dashboards:
    version: 2.3.0
    enable: true
    replicas: 1
    resources:
      requests:
         memory: &#34;1Gi&#34;
         cpu: &#34;500m&#34;
      limits:
         memory: &#34;1Gi&#34;
         cpu: &#34;500m&#34;
    tls:
      enable: true
      generate: false
      secret:
        name: cluster-http-cert
      caSecret:
        name: cluster-ca
  confMgmt:
    smartScaler: true
  security:
    config:
      securityConfigSecret:
# Pre create this secret with required security configs, to override the default settings
        name: securityconfig-secret
      adminCredentialsSecret:
        name: admin-credentials-secret
    tls:
      transport:
        generate: true
        caSecret:
          name: cluster-ca
      http:
        generate: false
        secret:
          name: cluster-http-cert
        caSecret:
          name: cluster-ca

  nodePools:
    - component: masters
      replicas: 3
      diskSize: &#34;50Gi&#34;
      persistence:
        pvc:
          storageClass: csi-qingcloud
          accessModes:
            - ReadWriteOnce
      nodeSelector:
      resources:
         requests:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
         limits:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
      roles:
        - &#34;cluster_manager&#34;

    - component: data-hot
      replicas: 2
      diskSize: &#34;80Gi&#34;
      persistence:
        pvc:
          storageClass: csi-qingcloud
          accessModes:
            - ReadWriteOnce
      additionalConfig:
        node.attr.datatier: &#34;hot&#34; # warm, cold
      resources:
         requests:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
         limits:
            memory: &#34;1Gi&#34;
            cpu: &#34;500m&#34;
      roles:
        - &#34;data&#34;

---
apiVersion: v1
kind: Secret
metadata:
  name: admin-credentials-secret
type: Opaque
data:
  username: c2h1YWliMTIz
  password: c2h1YWliMTIz</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>创建 OpenSearch 集群。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch# kubectl -n opensearch apply -f os-ssl-false.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>验证 OpenSearch 集群证书。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:/home/ubuntu/opensearch# kubectl -n opensearch exec -it os002-masters-0 -- /bin/bash
Defaulted container &#34;opensearch&#34; out of: opensearch, init (init)
[opensearch@os002-masters-0 ~]$ curl https://os002-masters-0.os002.opensearch.svc.cluster.local:9200/_cat/nodes --cacert /usr/share /opensearch/config/tls-http/ca.crt -u root:x804NqPd3tz7HBzr
10.10.2.138 63 95 17 2.16 1.68 1.42 m cluster_manager * os002-masters-0 10.10.194.120 49 94 6 4.88 2.75 1.75 d data - os002-data-hot-1 10.10.194.121 35 87 7 4.88 2.75 1.75 m cluster_manager - os002-masters-2 10.10.215.132 53 94 13 1.58 0.93 0.86 d data - os002-data-hot-0 10.10.215.133 28 88 8 1.58 0.93 0.86 m cluster_manager - os002-masters-1 [opensearch@os002-masters-0 ~]$</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>外部验证 OpenSearch 集群证书。</p>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>在 2.0.16 之前的 operator 版本，OpenSearch 集群 Service 类型默认为 ClusterIP，且不支持修改，故无法修改 service 类型为 NodePort 供外部访问集群。若需要外部访问，可以通过额外增加一个 NodePort 类型的 service 实现。</p>
</li>
<li>
<p>在 2.0.16 及以后的 operator 版本，service 默认类型已调整为 NodePort。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>获取 <strong>service/opensearch</strong> 的 YAML 配置，并重命名。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:~# kubectl -n opensearch get service/opensearch -oyaml &gt; opensearch-external.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>修改 <strong>opensearch-external.yaml</strong>。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/service: opensearch
    opster.io/exporter-monitor: &#34;yes&#34;
    opster.io/opensearch-cluster: opensearch
  name: opensearch-external
  namespace: opensearch
  ownerReferences:
  - apiVersion: opensearch.opster.io/v1
    blockOwnerDeletion: true
    controller: true
    kind: OpenSearchCluster
    name: opensearch
    uid: 5f16ee6c-35ba-460f-910a-fa88f4f32f86
spec:
  clusterIP: 10.96.220.19
  clusterIPs:
  - 10.96.220.19
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: http
    port: 9200
    protocol: TCP
    targetPort: 9200
  - name: transport
    port: 9300
    protocol: TCP
    targetPort: 9300
  - name: metrics
    port: 9600
    protocol: TCP
    targetPort: 9600
  - name: rca
    port: 9650
    protocol: TCP
    targetPort: 9650
  selector:
    opster.io/opensearch-cluster: opensearch
  sessionAffinity: None
  type: NodePort
status:
  loadBalancer: {}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>metadata 里保留 <strong>labels</strong>、<strong>name</strong>、<strong>namespace</strong>、<strong>ownerReferences</strong> 属性。</p>
</li>
<li>
<p>修改 <strong>metadata.name</strong> 字段，自定义 service 名称。</p>
</li>
<li>
<p>删除 <strong>spec.clusterIP</strong> 和 <strong>spec.clusterIPs</strong> 字段，防止 IP 冲突。</p>
</li>
<li>
<p>修改 <strong>spec.type</strong> 为 <strong>NodePort</strong>。</p>
<div class="paragraph">
<p>可参考以下示例：</p>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/service: opensearch
    opster.io/exporter-monitor: &#34;yes&#34;
    opster.io/opensearch-cluster: opensearch
  name: opensearch-external
  namespace: opensearch
  ownerReferences:
  - apiVersion: opensearch.opster.io/v1
    blockOwnerDeletion: true
    controller: true
    kind: OpenSearchCluster
    name: opensearch
    uid: 5f16ee6c-35ba-460f-910a-fa88f4f32f86
spec:
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: http
    port: 9200
    protocol: TCP
    targetPort: 9200
  - name: transport
    port: 9300
    protocol: TCP
    targetPort: 9300
  - name: metrics
    port: 9600
    protocol: TCP
    targetPort: 9600
  - name: rca
    port: 9650
    protocol: TCP
    targetPort: 9650
  selector:
    opster.io/opensearch-cluster: opensearch
  sessionAffinity: None
  type: NodePort
status:
  loadBalancer: {}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>创建 <strong>opensearch-external</strong> 服务。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:~# kubectl -n opensearch apply -f ./opensearch-external.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>检查服务是否创建成功。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@master1:~# kubectl -n opensearch get svc</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您能够在回显中找到 <strong>opensearch-external</strong> 服务，则该服务创建成功。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/dmp/os-external.png" alt="os external"/>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>配置 <strong>/etc/hosts</strong> 文件。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">echo &#34;172.22.9.17 os002-masters-0.os002.os002.opensearch.svc.cluster.local&#34; &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中，<strong>172.22.9.17</strong> 为任意节点名称，<strong>os002-masters-0.os002.os002.opensearch.svc.cluster.local</strong> 为其中一个 master 节点名称，可任意配置。</p>
</div>
</div>
</div>
</li>
<li>
<p>执行以下命令进行外部访问。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">root@i-abmm2sr0:~/test# curl https://os002-masters-0.os002.opensearch.svc.cluster.local:30255/_cat/nodes --cacert ./root-ca.pem -u root:x804NqPd3tz7HBzr
10.10.194.121 61 88 6 0.49 0.80 1.28 m cluster_manager - os002-masters-2
10.10.215.133 57 89 7 0.35 0.60 0.79 m cluster_manager - os002-masters-1
10.10.194.120 57 94 4 0.49 0.80 1.28 d data - os002-data-hot-1 10.10.2.138 34 95 5 3.41 2.13 1.80 m cluster_manager * os002-masters-0 10.10.215.132 57 95 8 0.35 0.60 0.79 d data - os002-data-hot-0</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_opensearch_集群内部自动生成证书">OpenSearch 集群内部自动生成证书</a></li>
    <li><a href="#_用户自定义证书">用户自定义证书</a></li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/js/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/search/jquery.mark.min.js"></script>

<script type="text/javascript" src="/js/common.428b8a7f426567136e0501d49705f10dac2e4539d10c2f396d7c9ee45df1469eaa38e983928589e0e35ed30c1732ddbcda694ac0928ffffffee76b4a0017adf2.js" integrity="sha512-QouKf0JlZxNuBQHUlwXxDawuRTnRDC85bXye5F3xRp6qOOmDkoWJ4ONe0wwXMt282mlKwJKP///&#43;52tKABet8g=="></script>

<script type="text/javascript" src="/js/search.d8001c3e1b66b9a0b48e0c23ad0dbfc0906f194f8925ae78a9900b960679cfa7e41cebd9efd654f84535d02cbce7c4971f226e6f07288c26c3c4560c36d7655b.js"></script>
<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
